---
description: Change proposal workflow - minimal implementation first, refactors separate
alwaysApply: true
---

# Change Proposal Workflow

## Structure Every Proposal

When proposing code changes, follow this structure:

### 1. Minimal Working Implementation (First)

Start with the **smallest change that works**:
- Focus on the feature/change requested
- Use existing patterns and utilities
- Make minimal edits to existing files
- Ensure it's complete and runnable

### 2. Refactor Suggestions (Separate Section)

After the working implementation, include a **separate "Refactor Suggestions"** section:

```markdown
## Refactor Suggestions

### [Feature/Area Name]
- **What**: [Specific extraction/improvement]
- **Why**: [Benefit - e.g., "Reduces coupling", "Improves testability"]
- **Risk**: low/medium/high
- **Steps**: 
  1. [First small step]
  2. [Second small step]
  3. [Third small step]
```

### 3. Keep Refactors Small and Staged

- **One refactor per suggestion** - don't bundle multiple changes
- **Order by priority** - most impactful first
- **Estimate risk** - helps decide when to tackle
- **Provide incremental steps** - each step should be independently safe

## Example Structure

```markdown
## Implementation

[Complete, working code changes here]

## Refactor Suggestions

### Extract Journal Processing Logic
- **What**: Move journal entry processing from app-api.js to `features/journal/processor.js`
- **Why**: Reduces app-api.js by ~150 lines, enables unit testing of business logic
- **Risk**: low (pure function extraction)
- **Steps**:
  1. Create `features/journal/processor.js` with pure functions
  2. Update app-api.js to import and call new module
  3. Test existing functionality unchanged
  4. Add unit tests for processor module

### Extract UI Update Logic
- **What**: Separate UI updates from business logic in journal handler
- **Why**: Enables state-driven approach, easier React migration later
- **Risk**: medium (touches UI rendering)
- **Steps**:
  1. Create `features/journal/ui-updater.js` for DOM manipulation
  2. Move UI code from app-api.js to updater
  3. Test UI behaviour matches exactly
  4. Consider state object pattern for future
```

## Key Principles

- ✅ **Working code first** - Never propose refactors without working solution
- ✅ **Separate sections** - Implementation vs suggestions are distinct
- ✅ **Small increments** - Each refactor suggestion is independently valuable
- ✅ **Risk assessment** - Helps prioritise what to tackle when
- ✅ **Actionable steps** - Each step should be clear and safe
